---
title: "Liste de Courses"
page-layout: full
format:
  html:
    toc: false
---

```{=html}

<div class="shopping-list-container">
  <div class="intro-section">
    <h2>üìù G√©n√©rer ma liste de courses</h2>
    <p>S√©lectionnez les recettes que vous souhaitez pr√©parer, ajustez les portions, et g√©n√©rez automatiquement votre liste de courses.</p>
  </div>

  <div class="recipes-selection">
    <h3>Mes Recettes</h3>
    <div class="search-filter">
      <input type="text" id="searchRecipes" placeholder="üîç Rechercher une recette..." onkeyup="filterRecipes()">
      <select id="categoryFilter" onchange="filterRecipes()">
        <option value="">Toutes les cat√©gories</option>
        <option value="entree">Entr√©es</option>
        <option value="plat">Plats</option>
        <option value="dessert">Desserts</option>
      </select>
    </div>

    <div id="recipesList" class="recipes-grid">
      <p class="loading">Chargement des recettes...</p>
    </div>
  </div>

  <div class="selected-section">
    <h3>Recettes s√©lectionn√©es (<span id="selectedCount">0</span>)</h3>
    <div id="selectedRecipes" class="selected-recipes">
      <p class="empty-message">Aucune recette s√©lectionn√©e</p>
    </div>
    <button id="generateButton" class="btn-primary btn-large" onclick="generateShoppingList()" disabled>
      üõí G√©n√©rer la liste de courses
    </button>
  </div>

  <div id="shoppingListOutput" style="display: none;">
    <h2>üõí Votre Liste de Courses</h2>
    <div class="list-actions">
      <button class="btn-secondary" onclick="copyShoppingList()">üìã Copier</button>
      <button class="btn-secondary" onclick="printShoppingList()">üñ®Ô∏è Imprimer</button>
      <button class="btn-secondary" onclick="downloadShoppingList()">üíæ T√©l√©charger</button>
    </div>
    <div id="shoppingListContent" class="shopping-list-content"></div>
  </div>
</div>

<style>
.shopping-list-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.intro-section {
  text-align: center;
  margin-bottom: 3rem;
}

.intro-section h2 {
  font-size: 2rem;
  margin-bottom: 1rem;
}

.search-filter {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.search-filter input,
.search-filter select {
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 1rem;
}

.search-filter input {
  flex: 1;
}

.search-filter select {
  min-width: 200px;
}

.recipes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 3rem;
}

.recipe-card {
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  background: white;
}

.recipe-card:hover {
  border-color: #007bff;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.recipe-card.selected {
  border-color: #28a745;
  background-color: #f0f9f4;
}

.recipe-card-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 0.5rem;
}

.recipe-card h4 {
  margin: 0;
  font-size: 1.1rem;
  flex: 1;
}

.recipe-checkbox {
  width: 24px;
  height: 24px;
  cursor: pointer;
}

.recipe-category {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 600;
  margin-top: 0.5rem;
}

.category-entree {
  background-color: #e3f2fd;
  color: #1976d2;
}

.category-plat {
  background-color: #fff3e0;
  color: #f57c00;
}

.category-dessert {
  background-color: #fce4ec;
  color: #c2185b;
}

.selected-section {
  background-color: #f8f9fa;
  padding: 2rem;
  border-radius: 8px;
  margin-bottom: 3rem;
}

.selected-recipes {
  min-height: 60px;
  margin-bottom: 1.5rem;
}

.selected-tag {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin: 0.5rem;
  font-size: 0.95rem;
  vertical-align: top;
}

.selected-tag-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.selected-tag-title {
  font-weight: 600;
}

.selected-tag-servings {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.85rem;
  color: #666;
}

.servings-input {
  width: 60px;
  padding: 0.25rem 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  text-align: center;
}

.selected-tag button {
  background: none;
  border: none;
  color: #dc3545;
  cursor: pointer;
  font-size: 1.2rem;
  padding: 0;
  line-height: 1;
}

.empty-message,
.loading {
  color: #999;
  font-style: italic;
  text-align: center;
  padding: 2rem;
}

.btn-primary,
.btn-secondary {
  padding: 1rem 2rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-primary {
  background-color: #007bff;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background-color: #0056b3;
}

.btn-primary:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
  margin: 0 0.5rem;
}

.btn-secondary:hover {
  background-color: #5a6268;
}

.btn-large {
  width: 100%;
  font-size: 1.2rem;
  padding: 1.25rem 2rem;
}

.list-actions {
  text-align: center;
  margin: 2rem 0;
}

.shopping-list-content {
  background: white;
  padding: 2rem;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.ingredient-category {
  margin-bottom: 2rem;
}

.ingredient-category h3 {
  color: #007bff;
  border-bottom: 2px solid #007bff;
  padding-bottom: 0.5rem;
  margin-bottom: 1rem;
}

.ingredient-category ul {
  list-style: none;
  padding: 0;
}

.ingredient-category li {
  padding: 0.5rem;
  margin: 0.25rem 0;
  background-color: #f8f9fa;
  border-radius: 4px;
  display: flex;
  align-items: center;
}

.ingredient-category li input[type="checkbox"] {
  margin-right: 1rem;
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.ingredient-category li.checked {
  text-decoration: line-through;
  opacity: 0.6;
}

@media print {
  .intro-section,
  .recipes-selection,
  .selected-section,
  .list-actions {
    display: none;
  }

  .shopping-list-content {
    border: none;
    padding: 0;
  }
}
</style>

<script>
let allRecipes = [];
let selectedRecipes = new Map(); // Map<recipeId, {recipe, servings}>

// Charger les recettes depuis le fichier JSON
async function loadRecipes() {
  try {
    const response = await fetch('recettes/recettes-data.json');
    allRecipes = await response.json();
    displayRecipes();
  } catch (error) {
    console.error('Erreur lors du chargement des recettes:', error);
    document.getElementById('recipesList').innerHTML =
      '<p class="empty-message">Erreur lors du chargement des recettes. Veuillez r√©essayer.</p>';
  }
}

function displayRecipes() {
  const container = document.getElementById('recipesList');
  if (allRecipes.length === 0) {
    container.innerHTML = '<p class="empty-message">Aucune recette disponible pour le moment.</p>';
    return;
  }

  container.innerHTML = allRecipes.map(recipe => `
    <div class="recipe-card ${selectedRecipes.has(recipe.id) ? 'selected' : ''}"
         onclick="toggleRecipe('${recipe.id}')"
         data-recipe-id="${recipe.id}"
         data-category="${recipe.category}">
      <div class="recipe-card-header">
        <h4>${recipe.title}</h4>
        <input type="checkbox"
               class="recipe-checkbox"
               ${selectedRecipes.has(recipe.id) ? 'checked' : ''}
               onclick="event.stopPropagation(); toggleRecipe('${recipe.id}')">
      </div>
      <div class="recipe-category category-${recipe.category}">
        ${recipe.category === 'entree' ? 'Entr√©e' : recipe.category === 'plat' ? 'Plat' : 'Dessert'}
      </div>
      <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
        ${recipe.ingredients.length} ingr√©dients ‚Ä¢ Pour ${recipe.servings} ${recipe.servings > 1 ? 'personnes' : 'personne'}
      </p>
    </div>
  `).join('');
}

function toggleRecipe(recipeId) {
  const recipe = allRecipes.find(r => r.id === recipeId);

  if (selectedRecipes.has(recipeId)) {
    selectedRecipes.delete(recipeId);
  } else {
    selectedRecipes.set(recipeId, {
      recipe: recipe,
      servings: recipe.servings
    });
  }
  updateUI();
}

function updateServings(recipeId, newServings) {
  const selection = selectedRecipes.get(recipeId);
  if (selection && newServings > 0) {
    selection.servings = parseInt(newServings);
    selectedRecipes.set(recipeId, selection);
  }
}

function updateUI() {
  // Mettre √† jour les cartes
  document.querySelectorAll('.recipe-card').forEach(card => {
    const id = card.dataset.recipeId;
    if (selectedRecipes.has(id)) {
      card.classList.add('selected');
      card.querySelector('.recipe-checkbox').checked = true;
    } else {
      card.classList.remove('selected');
      card.querySelector('.recipe-checkbox').checked = false;
    }
  });

  // Mettre √† jour la section des recettes s√©lectionn√©es
  const selectedContainer = document.getElementById('selectedRecipes');
  const count = document.getElementById('selectedCount');
  count.textContent = selectedRecipes.size;

  if (selectedRecipes.size === 0) {
    selectedContainer.innerHTML = '<p class="empty-message">Aucune recette s√©lectionn√©e</p>';
    document.getElementById('generateButton').disabled = true;
  } else {
    selectedContainer.innerHTML = Array.from(selectedRecipes.entries()).map(([id, selection]) => {
      const recipe = selection.recipe;
      return `
        <span class="selected-tag">
          <div class="selected-tag-content">
            <span class="selected-tag-title">${recipe.title}</span>
            <div class="selected-tag-servings">
              <label>Pour
                <input type="number"
                       class="servings-input"
                       value="${selection.servings}"
                       min="1"
                       max="99"
                       onclick="event.stopPropagation()"
                       onchange="updateServings('${id}', this.value)">
                ${selection.servings > 1 ? 'personnes' : 'personne'}
              </label>
            </div>
          </div>
          <button onclick="event.stopPropagation(); toggleRecipe('${id}')">√ó</button>
        </span>
      `;
    }).join('');
    document.getElementById('generateButton').disabled = false;
  }
}

function filterRecipes() {
  const searchTerm = document.getElementById('searchRecipes').value.toLowerCase();
  const category = document.getElementById('categoryFilter').value;

  document.querySelectorAll('.recipe-card').forEach(card => {
    const title = card.querySelector('h4').textContent.toLowerCase();
    const cardCategory = card.dataset.category;

    const matchesSearch = title.includes(searchTerm);
    const matchesCategory = !category || cardCategory === category;

    card.style.display = matchesSearch && matchesCategory ? 'block' : 'none';
  });
}

function parseIngredient(ingredient, ratio) {
  // Extraire les nombres et les multiplier par le ratio
  return ingredient.replace(/(\d+(?:[.,]\d+)?)/g, (match) => {
    const num = parseFloat(match.replace(',', '.'));
    const scaled = num * ratio;
    // Arrondir √† 1 d√©cimale si n√©cessaire
    return scaled % 1 === 0 ? scaled.toString() : scaled.toFixed(1).replace('.', ',');
  });
}

function generateShoppingList() {
  const ingredients = {};

  // Collecter tous les ingr√©dients des recettes s√©lectionn√©es avec ajustement des portions
  selectedRecipes.forEach((selection, recipeId) => {
    const recipe = selection.recipe;
    const ratio = selection.servings / recipe.servings;

    recipe.ingredients.forEach(ingredient => {
      const scaledIngredient = parseIngredient(ingredient, ratio);
      const key = ingredient.toLowerCase().replace(/\d+/g, '').trim(); // Cl√© normalis√©e pour grouper les ingr√©dients similaires

      if (!ingredients[key]) {
        ingredients[key] = {
          items: [scaledIngredient],
          recipes: [{ title: recipe.title, servings: selection.servings }]
        };
      } else {
        ingredients[key].items.push(scaledIngredient);
        ingredients[key].recipes.push({ title: recipe.title, servings: selection.servings });
      }
    });
  });

  // Cat√©goriser les ingr√©dients
  const categories = categorizeIngredients(ingredients);

  // Afficher la liste
  const output = document.getElementById('shoppingListOutput');
  const content = document.getElementById('shoppingListContent');

  let html = '<h3>Recettes s√©lectionn√©es:</h3><ul>';
  selectedRecipes.forEach((selection, id) => {
    const recipe = selection.recipe;
    html += `<li><strong>${recipe.title}</strong> - ${selection.servings} ${selection.servings > 1 ? 'personnes' : 'personne'}</li>`;
  });
  html += '</ul>';

  Object.keys(categories).forEach(category => {
    if (categories[category].length > 0) {
      html += `<div class="ingredient-category">
        <h3>${category}</h3>
        <ul>`;
      categories[category].forEach(item => {
        const uniqueItems = [...new Set(item.items)]; // Supprimer les doublons
        const detail = item.recipes.length > 1 ?
          ` <small>(${item.recipes.map(r => r.title).join(', ')})</small>` : '';

        uniqueItems.forEach(ing => {
          html += `<li>
            <input type="checkbox" onchange="this.parentElement.classList.toggle('checked')">
            <span>${ing}${detail}</span>
          </li>`;
        });
      });
      html += '</ul></div>';
    }
  });

  content.innerHTML = html;
  output.style.display = 'block';
  output.scrollIntoView({ behavior: 'smooth' });
}

function categorizeIngredients(ingredients) {
  const categories = {
    'Fruits et L√©gumes': [],
    'Viandes et Poissons': [],
    'Produits Laitiers': [],
    '√âpicerie': [],
    'Condiments et √âpices': [],
    'Autres': []
  };

  const fruitLegumes = ['pomme', 'poire', 'tomate', 'oignon', 'ail', 'champignon', 'carotte', 'poireau', 'salade', 'courgette', 'aubergine'];
  const viandes = ['poulet', 'b≈ìuf', 'porc', 'poisson', 'saumon', 'thon', 'viande'];
  const laitiers = ['lait', 'cr√®me', 'beurre', 'fromage', 'parmesan', 'yaourt', 'mozzarella'];
  const epicerie = ['riz', 'p√¢tes', 'farine', 'sucre', 'p√¢te', 'bouillon', 'vin'];
  const condiments = ['sel', 'poivre', 'huile', 'vinaigre', 'moutarde', 'cannelle', 'confiture', 'arborio'];

  Object.values(ingredients).forEach(item => {
    const lower = item.items[0].toLowerCase();

    if (fruitLegumes.some(f => lower.includes(f))) {
      categories['Fruits et L√©gumes'].push(item);
    } else if (viandes.some(v => lower.includes(v))) {
      categories['Viandes et Poissons'].push(item);
    } else if (laitiers.some(l => lower.includes(l))) {
      categories['Produits Laitiers'].push(item);
    } else if (epicerie.some(e => lower.includes(e))) {
      categories['√âpicerie'].push(item);
    } else if (condiments.some(c => lower.includes(c))) {
      categories['Condiments et √âpices'].push(item);
    } else {
      categories['Autres'].push(item);
    }
  });

  return categories;
}

function copyShoppingList() {
  const content = document.getElementById('shoppingListContent');
  const text = content.innerText;
  navigator.clipboard.writeText(text).then(() => {
    alert('Liste de courses copi√©e!');
  });
}

function printShoppingList() {
  window.print();
}

function downloadShoppingList() {
  const content = document.getElementById('shoppingListContent').innerText;
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'liste-courses.txt';
  a.click();
  URL.revokeObjectURL(url);
}

// Charger les recettes au chargement de la page
loadRecipes();
</script>
```
